---
title: "Final Project STAT184"
author: "Milo Schmitt, Matt Viana"
date: "2023-12-05"
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loadPackages, include=FALSE}
#Load packages with groundhog
library(groundhog)
library(gridExtra)
library(knitr)
library(tidyr)
library(dplyr)

pkgs <- c("ggplot2", "dplyr", "janitor", "kableExtra", "knitr", "tidyr")

groundhog.library(pkgs, '2023-12-01')
```

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

# reading tables and filtering to relevant data

league_EUW <- read.table(
  file = "C:\\Users\\Matheus Viana\\Documents\\Blackmagic Design\\Final Project\\games (1).csv",
  header = TRUE,
  sep = ','
)

league_BR <- read.table(
  file = "C:\\Users\\Matheus Viana\\Documents\\Blackmagic Design\\Final Project\\full_data_100.csv",
  header = TRUE,
  sep = ','
)
# limit to only the necessary data, which is statistics which are shared between data frames (ex. both data frames have a column to show which team got first blood)
league_BR <- league_BR[, c("blueWin", "blueFirstBlood", "blueDragonKill", "redDragonKill", "blueRiftHeraldKill", "redRiftHeraldKill", "blueBaronKill", "redBaronKill")]

league_EUW <- league_EUW[, c("winner", "firstBlood", "t1_dragonKills", "t2_dragonKills", "t1_riftHeraldKills", "t2_riftHeraldKills", "t1_baronKills", "t2_baronKills")]


league_EUW
league_BR
```

# Determining indicators of win percentage in League of Legends 

### Abstract:

League of Legends, normally referred to as LoL stands as one of the most popular and competitive multiplayer online battle arena (MOBA) games globally. Its main draw is its fast-paced, and strategic competitive nature. Players aim to win at any cost, a small lead can place you in an advantageous position to take control of the game. As a statistical analyst delving into the data-heavy world of LoL, this project aims to unravel the dynamics and nuances within ranked games to determine the highest indicators of win percentage. 

The focus of this analysis was on exploring 116,046 matches between two distinct servers: the Brazilian Server for season 13 containing 64,556 matches and the High Elo tiers (top 1% of players) on the Western European Server in season 9 containing 51,490 matches. Every in-game season brings with it large updates to the game that create variations in strategies and playstyles. Additionally, variations between a large number of seasons have a compounding effect. Moreover, different servers have distinct cultures reflecting their real-world bias. Even though strategies might change, the in-game objectives largely stay the same. The theory behind this analysis comes from the idea that by analyzing the win percentage based on constant objectives through wildly different seasons, servers, and ranks, we can determine universal victory indicators. 

By scrutinizing comprehensive datasets and employing robust statistical methodologies using R programming, this research endeavors to shed light on patterns that enable victory. Understanding these intricate aspects not only advances our comprehension of player behaviors but also contributes significantly to developing strategies and the landscape of competitive gaming analysis.

### Recognizing the Criteria:

An important note before we begin is that LoL is a nuanced game, and teams have won games despite insurmountable odds. We will begin by discussing general terminology and objectives.

In its simplest form, League of Legends is a five versus five objective-capturing game, the team that captures the adversary's base (Nexus) wins. Matches are usually around 30 minutes long. Each player is represented by one Champion who increases in power as the game goes on by leveling up with experience points and buying in-game items with gold. Though capturing the Nexus is the final goal there are five other capturable objectives, consisting of two structure objectives, Towers, and Inhibitors, and three monster objectives, Drakes, Rift Heralds, and Barons. Moreover, objectives are only available on the map at a specific time. They are accessible to both teams at the same time providing gold and experience points as a reward at capture. Additionally, they also provide a special in-game bonus, ranging from basic upgrades to character attributes, all the way to deployable siege weapons.

With this information in mind, we decided to analyze five in-game attributes:

-   First Blood: The first team to eliminate a champion from the other team.

-   Victorious Side: Each team is assigned an opposite side of the map to defend. Blue or Red.

-   Amount of Drakes Captured: Amount of Drake objectives captured by each team.

-   Amount of Rift Heralds Captured: Amount of Rift Herald's objectives captured by each team.

-   Amount of Barons Captured: Amount of Baron objectives captured by each team.

### Surveying the Data:

An obvious starting point was to determine if there are differences in win rate based on in-game geographical differences. In other words, are both side's win rates(Red or Top Side, and Blue or Bottom Side) equal? 

It immediately stands out that if the differences in Table One are significant, that would be highly degrading to the player empowerment ideals of LoL's skill-based matchmaking and competitive viability.

```{r first blood plots euw, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Calculate BR %
br_percentages <- prop.table(table(league_BR$blueWin)) * 100

# Calculate EUW %
euw_percentages <- prop.table(table(factor(league_EUW$winner, levels = c(1, 2)))) * 100


data_plot <- data.frame(
  Category = c("BR_Blue", "BR_Red", "EUW_Blue", "EUW_Red"),
  Percentage = c(br_percentages[2], br_percentages[1], euw_percentages[1], euw_percentages[2])
)


filtered_data <- data_plot[data_plot$Percentage >= 40 & data_plot$Percentage <= 60, ]

# Create a bar plot
ggplot(data_plot, aes(x = Category, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity") +
  geom_text(data = filtered_data, aes(label = paste0(sprintf("%.2f", Percentage), "%")),
            vjust = -0.5, size = 3, color = "black") +
  labs(
    title = "Percentage Distribution: Blue vs. Red",
    x = "Category",
    y = "Percentage"
  ) +
  scale_fill_manual(values = c("#3498db", "#e74c3c", "#3498db", "#e74c3c")) +
  theme_minimal() +
  coord_cartesian(ylim = c(40, 60)) 
```

By creating a simple bar plot and limiting the Y axis between 40% and 60%, two consistencies between the data sets are on display. Firstly, the difference between both teams is as close to zero as a player could ever demand in a dynamic and competitive game. Secondly, the Blue Team consistently has the slightest of upper hands.

On the note of in-game geography, the second metric to verify is if there are any advantages to objective capture rates based on a team's location.  Due to the map being mirrored on both sides, the Red Team should have easier access to Drake objectives, while the Blue Side should have easier access to Baron and Rift Herald objectives (Baron and Rift Herald are in the same location).

```{r drake plots euw, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}

combined_dragons_EUW <- league_EUW %>%
  select(winner, t1_dragonKills, t2_dragonKills) %>%
  gather(key = "side", value = "dragonKills", -winner) %>%
  mutate(side = ifelse(side == "t1_dragonKills", 1, 2))

# calculating winrates 
dragon_wr_EUW <- combined_dragons_EUW %>%
  group_by(dragonKills, winner, side) %>%
  summarise(count = n()) %>%
  group_by(dragonKills, side) %>%
  mutate(win_rate = ifelse(winner == side, count / sum(count) * 100, 0))

# create a histogram
plot1 <- ggplot(dragon_wr_EUW, 
       aes(x = dragonKills, 
           y = win_rate, 
           fill = factor(winner))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates of Drake Kills (EU)",
       x = "Number of Drake Kills",
       y = "Win Rate (%)") +
  facet_wrap(~side, scales = "free_y", labeller = labeller(side = c("1" = "Blue Side", "2" = "Red Side"))) +
  theme_minimal() +
  theme(legend.position = "none")

# don't know how to manually edit the text of a legend, which would show '1' or '2' so I removed the legend
# the data is pretty self-explanatory in this case anyways, especially when each graph is already labelled blue or red side

combined_dragons_BR <- league_BR %>%
  select(blueWin, blueDragonKill, redDragonKill) %>%
  gather(key = "side", value = "dragonKills", -blueWin) %>%
  mutate(side = ifelse(side == "blueDragonKill", TRUE, FALSE))

# since the data is now true or false instead of 1 or 2, they can be turned logical to make future wrangling easier
combined_dragons_BR$blueWin <- as.logical(combined_dragons_BR$blueWin)

# calculating winrates
dragon_wr_BR <- combined_dragons_BR %>%
  group_by(dragonKills, blueWin, side) %>%
  summarise(count = n()) %>%
  group_by(dragonKills, side) %>%
  mutate(win_rate = ifelse(blueWin == side, count / sum(count) * 100, 0))

# create histogram
plot2 <- ggplot(dragon_wr_BR, 
       aes(x = dragonKills, 
           y = win_rate, 
           fill = factor(blueWin))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates of Drake Kills (Brazil)",
       x = "Number of Drake Kills",
       y = "Win Rate (%)") +
  facet_wrap(~side, scales = "free", labeller = labeller(side = c("FALSE" = "Blue Side", "TRUE" = "Red Side"))) +
  theme_minimal() +
  theme(legend.position = "none")

# the same was done here, legend is gone because it only shows "TRUE" or "FALSE", which is unnecessary

grid.arrange(plot1, plot2, ncol = 2)


```

This time around the differences between the servers are more noticeable between servers and between home and away sides. Additionally, it seems like the effects of having more objectives are more noticeable in the EUW server, composed of some of the top-ranking players in the world. This is likely due to the skilled players knowing how to take control of small advantages and adapt strategies to accommodate small victories.  Whereas lower-ranked players tend to overplay their hands and make mistakes that lead to a loss of advantage. This would also explain the drop after the 5th Drake. As the game goes on there is a power ceiling, meaning as far as in-game bonuses go, both teams are likely comparable at that point in the match, reducing the effects of objective captures slightly. Even so, the relation between win percentage and Drake objectives captured is undeniable.

```{r baron herald kills, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Rift Baron EU

combined_objectives_EUW <- league_EUW %>%
  select(winner, t1_riftHeraldKills, t2_riftHeraldKills, t1_baronKills, t2_baronKills) %>%
  gather(key = "objective", value = "kills", -winner) %>%
  separate(objective, into = c("team", "objective"), sep = "_") %>%
  mutate(team = ifelse(team == "t1", 1, 2))

objectives_wr_EUW <- combined_objectives_EUW %>%
  group_by(kills, winner, team, objective) %>%
  summarise(count = n()) %>%
  group_by(kills, team, objective) %>%
  mutate(win_rate = ifelse(winner == team, count / sum(count) * 100, 0))

plot3 <- ggplot(objectives_wr_EUW, 
       aes(x = kills, 
           y = win_rate, 
           fill = factor(winner))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates: Rift Herald, Baron (EUW)",
       x = "Number of Kills",
       y = "Win Rate (%)") +
  facet_wrap(~objective, scales = "free_y", labeller = labeller(objective = c("riftHeraldKills" = "Rift Herald Kills", "baronKills" = "Baron Kills")), ncol = 4) +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 100))


#Rift Baron BR
combined_objectives_BR <- league_BR %>%
  select(blueRiftHeraldKill, redRiftHeraldKill, blueBaronKill, redBaronKill) %>%
  pivot_longer(cols = everything(), names_to = "objective", values_to = "kills") %>%
  separate(objective, into = c("team", "objective"), sep = "(?<=blue|red)(?=Rift|Baron)") %>%
  mutate(team = ifelse(team == "blue", TRUE, FALSE))

objectives_wr_BR <- combined_objectives_BR %>%
  group_by(kills, team, objective) %>%
  summarise(count = n()) %>%
  group_by(kills, objective) %>%
  mutate(total_count = sum(count)) %>%
  mutate(win_rate = count / total_count * 100) %>%
  ungroup()  

plot4 <- ggplot(objectives_wr_BR, 
       aes(x = kills, 
           y = win_rate, 
           fill = factor(team))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates: Rift Herald, Baron (Brazil)",
       x = "Number of Kills",
       y = "Win Rate (%)") +
  facet_wrap(~objective, scales = "free", labeller = labeller(objective = c("RiftHeraldKill" = "Rift Herald Kills", "BaronKill" = "Baron Kills")), ncol = 4) +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 100)) 

grid.arrange(plot3, plot4, ncol = 2)

# table
baron_summary <- objectives_wr_BR %>%
  filter(objective == "BaronKill") %>%
  group_by(kills, team) %>%
  summarise(total_count = sum(count)) %>%
  pivot_wider(names_from = team, values_from = total_count) %>%
  mutate(win_rate_blue = ifelse(!is.na(`TRUE`) & !is.na(`FALSE`), `FALSE` / (`TRUE` + `FALSE`) * 100, 0),
         win_rate_red = ifelse(!is.na(`TRUE`) & !is.na(`FALSE`), `TRUE` / (`TRUE` + `FALSE`) * 100, 0)) %>%
  summarise(avg_win_rate_blue = mean(win_rate_blue),
            avg_win_rate_red = mean(win_rate_red))

kable(baron_summary, format = "markdown", caption = "Average Win Rates for Baron Kills in Brazil")



```

As a student, analyst, and player, the results of this data have a direct effect on me. Part of the draw of researching a topic I am passionate about is the possibility of being surprised. With that said, I never expected these results.

These graphs show the results of the win rate based on the captured objectives of Baron and Rift Herald. The Rift Herald is only available for a limited time, and a second one only spawns if the first Harold is killed before the 14-minute mark. Therefore, in high-ranked matches for EUW, it is understandable why it is never seen. Players who place more value on objectives would guard them better. Noticeably, at 4 Baron objectives captured, the Blue Team has a 10% advantage over the Red Team.

Oddly, the Herald win percentage differences are significant for each team in the Brazilian servers. When no team captures Herald, the Blue Team has a large advantage, additionally, the Red Team has an even greater chance at victory if they capture both Heralds than the Blue Team does if they capture it. Finally, the data I was shocked about and the reason I decided to only tabulate Baron win rates, specifically for the Brazilian servers, is that there is no reliable numeric advantage for capturing a Baron. Though it might be tempting to label them as regional differences, I am more inclined to attribute this to player rank. The European data accounted for a small percentage of the player base in that region, whereas the Brazilian data measured over 90% of players. Individuals who are less knowledgeable on their approach to taking advantage of the game-defining benefits of Baron. 

It seems to be that every objective is worth its weight in gold for skilled players, and the coordination and carefulness required for the capture greatly affect its value for lower-ranked players.

```{r first bloor, echo=FALSE, message=FALSE, warning=FALSE}
league_EUW <- league_EUW %>%
  filter(firstBlood != 0)

summary_fb_EUW <- league_EUW %>%
  group_by(firstBlood, winner) %>%
  summarise(count = n()) %>%
  mutate(winrate = count / sum(count) * 100)

plot1 <- ggplot(summary_fb_EUW, 
                aes(x = factor(firstBlood), 
                    y = winrate, fill = factor(winner))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates based on First Blood (EUW)",
       x = "First Blood",
       y = "Win Rate (%)") +
  scale_x_discrete(labels = c("Blue Side", "Red Side")) +
  theme_minimal() +
  theme(legend.text = element_blank())

league_BR <- league_BR %>%
  filter(blueFirstBlood != 0)

summary_fb_BR <- league_BR %>%
  group_by(blueFirstBlood, blueWin) %>%
  summarise(count = n()) %>%
  mutate(winrate = count / sum(count) * 100)

plot2 <- ggplot(summary_fb_BR, 
                aes(x = factor(blueFirstBlood), 
                    y = winrate, 
                    fill = factor(blueWin))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates based on First Blood (Brazil)",
       x = "First Blood",
       y = "Win Rate (%)") +
  scale_x_discrete(labels = c("Blue Side", "Red Side")) +
  theme_minimal() +
  theme(legend.text = element_blank())

grid.arrange(plot1, plot2, ncol = 2)

# Making Tables -MV
table_EUW <- summary_fb_EUW %>%
  select(-firstBlood) %>%
  spread(winner, winrate)

table_BR <- summary_fb_BR %>%
  select(-blueFirstBlood) %>%
  spread(blueWin, winrate)

# Display tables using kable
kable(table_EUW, format = "markdown", caption = "Win Rates based on First Blood (EUW) Note: Blue Team is team 1") 

kable(table_BR, format = "markdown", caption = "Win Rates based on First Blood (Brazil) Note: Blue Team is team 1") 

```

The last metric measured was the First Blood. Defined as the first elimination for a match, the player responsible gains a bonus 33% gold reward when compared to later eliminations, which leads to early advantages in power and team morale.  This data point most clearly indicates a consistent and statistically significant increase in win rate at nearly 60% regardless of team, server, or skill level.

### Conclusion:

The investigation into League of Legends (LoL) aimed to decipher the critical factors dictating victory in this highly competitive multiplayer online battle arena (MOBA) game. Analyzing over 116,000 matches from both the Brazilian and Western European servers across different seasons and player ranks, the study homed in on specific in-game metrics to unveil universal indicators of success. Despite the ever-evolving strategies and game updates with each new season, key objectives like First Blood, team sides, and objective captures remained constant. This study sought to illuminate these constants across diverse seasons, servers, and player ranks to uncover their role as fundamental drivers of victory.

The analysis revealed intriguing nuances. Minor disparities between the Red and Blue teams' win rates challenged the established notions of skill-based matchmaking, with the Blue Team consistently maintaining a slight edge. Further exploration into objective capture rates, particularly Drake objectives, showcased a compelling correlation between the number of captures and win percentage. However, the analysis of Baron and Rift Herald uncovered unexpected patterns. While Rift Herald captures exhibited substantial differences across servers, the Brazilian data notably revealed no consistent advantage for capturing a Baron, potentially tied to player knowledge and rank. Notably, securing First Blood emerged as a significant predictor of victory, exhibiting a consistent increase in win rate regardless of server or player skill level. Overall, this deep dive into LoL's multifaceted gameplay provided invaluable insights into the intricate relationship between specific objectives and win rates, shedding light on strategic gameplay dynamics within competitive gaming.

### Works Cited:

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Junior, Jailson Barros da Silva, and Claudio Campelo. "League of Legends Match Data at Various Time Intervals." *Zenodo*, Zenodo, 31 Aug. 2023, zenodo.org/records/8303397.

"League of Legends Wiki." *Fandom*, leagueoflegends.fandom.com/wiki/League_of_Legends_Wiki. Accessed 13 Dec. 2023.

Roopnaire, Kristian. "ML-League-Of-Legends." *GitHub*, github.com/Kristian-Roopnarine/ML-League-Of- Legends/blob/master/games.csv. Accessed 13 Dec. 2023.

### Code Appendix:

```{r codeAppedix, eval=FALSE, message=TRUE, warning=TRUE, include=FALSE, paged.print=TRUE}
# Calculate BR %
br_percentages <- prop.table(table(league_BR$blueWin)) * 100

# Calculate EUW %
euw_percentages <- prop.table(table(factor(league_EUW$winner, levels = c(1, 2)))) * 100


data_plot <- data.frame(
  Category = c("BR_Blue", "BR_Red", "EUW_Blue", "EUW_Red"),
  Percentage = c(br_percentages[2], br_percentages[1], euw_percentages[1], euw_percentages[2])
)


filtered_data <- data_plot[data_plot$Percentage >= 40 & data_plot$Percentage <= 60, ]

# Create a bar plot
ggplot(data_plot, aes(x = Category, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity") +
  geom_text(data = filtered_data, aes(label = paste0(sprintf("%.2f", Percentage), "%")),
            vjust = -0.5, size = 3, color = "black") +
  labs(
    title = "Percentage Distribution: Blue vs. Red",
    x = "Category",
    y = "Percentage"
  ) +
  scale_fill_manual(values = c("#3498db", "#e74c3c", "#3498db", "#e74c3c")) +
  theme_minimal() +
  coord_cartesian(ylim = c(40, 60))

combined_dragons_EUW <- league_EUW %>%
  select(winner, t1_dragonKills, t2_dragonKills) %>%
  gather(key = "side", value = "dragonKills", -winner) %>%
  mutate(side = ifelse(side == "t1_dragonKills", 1, 2))

# calculating winrates 
dragon_wr_EUW <- combined_dragons_EUW %>%
  group_by(dragonKills, winner, side) %>%
  summarise(count = n()) %>%
  group_by(dragonKills, side) %>%
  mutate(win_rate = ifelse(winner == side, count / sum(count) * 100, 0))

# create a histogram
plot1 <- ggplot(dragon_wr_EUW, 
       aes(x = dragonKills, 
           y = win_rate, 
           fill = factor(winner))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates of Drake Kills (EU)",
       x = "Number of Drake Kills",
       y = "Win Rate (%)") +
  facet_wrap(~side, scales = "free_y", labeller = labeller(side = c("1" = "Blue Side", "2" = "Red Side"))) +
  theme_minimal() +
  theme(legend.position = "none")

# don't know how to manually edit the text of a legend, which would show '1' or '2' so I removed the legend
# the data is pretty self-explanatory in this case anyways, especially when each graph is already labelled blue or red side

combined_dragons_BR <- league_BR %>%
  select(blueWin, blueDragonKill, redDragonKill) %>%
  gather(key = "side", value = "dragonKills", -blueWin) %>%
  mutate(side = ifelse(side == "blueDragonKill", TRUE, FALSE))

# since the data is now true or false instead of 1 or 2, they can be turned logical to make future wrangling easier
combined_dragons_BR$blueWin <- as.logical(combined_dragons_BR$blueWin)

# calculating winrates
dragon_wr_BR <- combined_dragons_BR %>%
  group_by(dragonKills, blueWin, side) %>%
  summarise(count = n()) %>%
  group_by(dragonKills, side) %>%
  mutate(win_rate = ifelse(blueWin == side, count / sum(count) * 100, 0))

# create histogram
plot2 <- ggplot(dragon_wr_BR, 
       aes(x = dragonKills, 
           y = win_rate, 
           fill = factor(blueWin))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates of Drake Kills (Brazil)",
       x = "Number of Drake Kills",
       y = "Win Rate (%)") +
  facet_wrap(~side, scales = "free", labeller = labeller(side = c("FALSE" = "Blue Side", "TRUE" = "Red Side"))) +
  theme_minimal() +
  theme(legend.position = "none")

# the same was done here, legend is gone because it only shows "TRUE" or "FALSE", which is unnecessary

grid.arrange(plot1, plot2, ncol = 2)
league_EUW <- league_EUW %>%
  filter(firstBlood != 0)

summary_fb_EUW <- league_EUW %>%
  group_by(firstBlood, winner) %>%
  summarise(count = n()) %>%
  mutate(winrate = count / sum(count) * 100)

plot1 <- ggplot(summary_fb_EUW, 
                aes(x = factor(firstBlood), 
                    y = winrate, fill = factor(winner))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates based on First Blood (EUW)",
       x = "First Blood",
       y = "Win Rate (%)") +
  scale_x_discrete(labels = c("Blue Side", "Red Side")) +
  theme_minimal() +
  theme(legend.text = element_blank())

league_BR <- league_BR %>%
  filter(blueFirstBlood != 0)

summary_fb_BR <- league_BR %>%
  group_by(blueFirstBlood, blueWin) %>%
  summarise(count = n()) %>%
  mutate(winrate = count / sum(count) * 100)

plot2 <- ggplot(summary_fb_BR, 
                aes(x = factor(blueFirstBlood), 
                    y = winrate, 
                    fill = factor(blueWin))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates based on First Blood (Brazil)",
       x = "First Blood",
       y = "Win Rate (%)") +
  scale_x_discrete(labels = c("Blue Side", "Red Side")) +
  theme_minimal() +
  theme(legend.text = element_blank())

grid.arrange(plot1, plot2, ncol = 2)

# Making Tables -MV
table_EUW <- summary_fb_EUW %>%
  select(-firstBlood) %>%
  spread(winner, winrate)

table_BR <- summary_fb_BR %>%
  select(-blueFirstBlood) %>%
  spread(blueWin, winrate)

# Display tables using kable
kable(table_EUW, format = "markdown", caption = "Win Rates based on First Blood (EUW) Note: Blue Team is team 1") 

kable(table_BR, format = "markdown", caption = "Win Rates based on First Blood (Brazil) Note: Blue Team is team 1")
# # Rift Baron EU
combined_objectives_EUW <- league_EUW %>%
  select(winner, t1_riftHeraldKills, t2_riftHeraldKills, t1_baronKills, t2_baronKills) %>%
  gather(key = "objective", value = "kills", -winner) %>%
  separate(objective, into = c("team", "objective"), sep = "_") %>%
  mutate(team = ifelse(team == "t1", 1, 2))

objectives_wr_EUW <- combined_objectives_EUW %>%
  group_by(kills, winner, team, objective) %>%
  summarise(count = n()) %>%
  group_by(kills, team, objective) %>%
  mutate(win_rate = ifelse(winner == team, count / sum(count) * 100, 0))

plot3 <- ggplot(objectives_wr_EUW, 
       aes(x = kills, 
           y = win_rate, 
           fill = factor(winner))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates: Rift Herald, Baron (EUW)",
       x = "Number of Kills",
       y = "Win Rate (%)") +
  facet_wrap(~objective, scales = "free_y", labeller = labeller(objective = c("riftHeraldKills" = "Rift Herald Kills", "baronKills" = "Baron Kills")), ncol = 4) +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 100))


#Rift Baron BR
combined_objectives_BR <- league_BR %>%
  select(blueRiftHeraldKill, redRiftHeraldKill, blueBaronKill, redBaronKill) %>%
  pivot_longer(cols = everything(), names_to = "objective", values_to = "kills") %>%
  separate(objective, into = c("team", "objective"), sep = "(?<=blue|red)(?=Rift|Baron)") %>%
  mutate(team = ifelse(team == "blue", TRUE, FALSE))

objectives_wr_BR <- combined_objectives_BR %>%
  group_by(kills, team, objective) %>%
  summarise(count = n()) %>%
  group_by(kills, objective) %>%
  mutate(total_count = sum(count)) %>%
  mutate(win_rate = count / total_count * 100) %>%
  ungroup()  

plot4 <- ggplot(objectives_wr_BR, 
       aes(x = kills, 
           y = win_rate, 
           fill = factor(team))) +
  geom_bar(stat = "identity", position = "dodge", color = "white") +
  scale_fill_manual(values = c("#3498db", "#e74c3c"), name = "Winner") +
  labs(title = "Win Rates: Rift Herald, Baron (Brazil)",
       x = "Number of Kills",
       y = "Win Rate (%)") +
  facet_wrap(~objective, scales = "free", labeller = labeller(objective = c("RiftHeraldKill" = "Rift Herald Kills", "BaronKill" = "Baron Kills")), ncol = 4) +
  theme_minimal() +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(0, 100)) 

grid.arrange(plot3, plot4, ncol = 2)

# table
baron_summary <- objectives_wr_BR %>%
  filter(objective == "BaronKill") %>%
  group_by(kills, team) %>%
  summarise(total_count = sum(count)) %>%
  pivot_wider(names_from = team, values_from = total_count) %>%
  mutate(win_rate_blue = ifelse(!is.na(`TRUE`) & !is.na(`FALSE`), `FALSE` / (`TRUE` + `FALSE`) * 100, 0),
         win_rate_red = ifelse(!is.na(`TRUE`) & !is.na(`FALSE`), `TRUE` / (`TRUE` + `FALSE`) * 100, 0)) %>%
  summarise(avg_win_rate_blue = mean(win_rate_blue),
            avg_win_rate_red = mean(win_rate_red))

avg_dragon_kills_EUW <- c(mean(league_EUW$t1_dragonKills), mean(league_EUW$t2_dragonKills))
avg_rift_herald_kills_EUW <- c(mean(league_EUW$t1_riftHeraldKills), mean(league_EUW$t2_riftHeraldKills))
avg_baron_kills_EUW <- c(mean(league_EUW$t1_baronKills), mean(league_EUW$t2_baronKills))

avg_dragon_kills_EUW
avg_rift_herald_kills_EUW
avg_baron_kills_EUW

# new data frame with 6 rows
avg_kills_EUW_data <- data.frame(
  Team = rep(c("Blue Team", "Red Team"), each = 3),
  Category = rep(c("Dragon Kills", "Rift Herald Kills", "Baron Kills"), times = 2),
  AvgKills = c(avg_dragon_kills_EUW[1], avg_rift_herald_kills_EUW[1], avg_baron_kills_EUW[1],
              avg_dragon_kills_EUW[2], avg_rift_herald_kills_EUW[2], avg_baron_kills_EUW[2])
)

# plot this new data frame as histogram
ggplot(avg_kills_EUW_data, aes(x = Team, y = AvgKills, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Team", y = "Average Kills", title = "Average Kills Per Game by Objective") +
  scale_fill_manual(values = c("#3498db", "#e74c3c", "#2ecc71"), name = "Objective") +
  theme_minimal()
avg_dragon_kills_BR <- c(mean(league_BR$blueDragonKill), mean(league_BR$redDragonKill))
avg_rift_herald_kills_BR <- c(mean(league_BR$blueRiftHeraldKill), mean(league_BR$redRiftHeraldKill))
avg_baron_kills_BR <- c(mean(league_BR$blueBaronKill), mean(league_BR$redBaronKill))

# new data frame
avg_kills_BR_data <- data.frame(
  Team = rep(c("Blue Side", "Red Side"), each = 3),
  Category = rep(c("Dragon", "Rift Herald", "Baron"), times = 2),
  AvgKills = c(avg_dragon_kills_BR[1], avg_rift_herald_kills_BR[1], avg_baron_kills_BR[1],
               avg_dragon_kills_BR[2], avg_rift_herald_kills_BR[2], avg_baron_kills_BR[2])
)

# plotting
ggplot(avg_kills_BR_data, aes(x = Team, y = AvgKills, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Team", y = "Average Kills", title = "Average Kills Per Game by Objective (Brazil)") +
  scale_fill_manual(values = c("#3498db", "#e74c3c", "#2ecc71"), name = "Objective") +
  theme_minimal()
# add all dragon kills and all baron kills, plot the avg per game against each other
ggplot(league_EUW, aes(x = t1_dragonKills + t2_dragonKills, y = t1_baronKills + t2_baronKills)) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(x = "Dragon Kills", y = "Baron Kills", title = "Dragon Kills vs Baron Kills (EUW)") +
  theme_minimal()
# same for br data
ggplot(league_BR, aes(x = blueDragonKill + redDragonKill, y = blueBaronKill + redBaronKill)) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  labs(x = "Dragon Kills", y = "Baron Kills", title = "Dragon Kills vs Baron Kills (Brazil)") +
  theme_minimal()

```
